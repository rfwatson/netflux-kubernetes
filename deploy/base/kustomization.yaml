---
resources:
# Prometheus
- inflated/prometheus/charts/kube-state-metrics/templates/serviceaccount.yaml
- inflated/prometheus/charts/kube-state-metrics/templates/deployment.yaml
- inflated/prometheus/charts/kube-state-metrics/templates/role.yaml
- inflated/prometheus/charts/kube-state-metrics/templates/service.yaml
- inflated/prometheus/charts/kube-state-metrics/templates/clusterrolebinding.yaml
- inflated/prometheus/templates/node-exporter/daemonset.yaml
- inflated/prometheus/templates/node-exporter/serviceaccount.yaml
- inflated/prometheus/templates/node-exporter/svc.yaml
- inflated/prometheus/templates/pushgateway/serviceaccount.yaml
- inflated/prometheus/templates/pushgateway/service.yaml
- inflated/prometheus/templates/pushgateway/clusterrole.yaml
- inflated/prometheus/templates/pushgateway/deploy.yaml
- inflated/prometheus/templates/pushgateway/clusterrolebinding.yaml
- inflated/prometheus/templates/alertmanager/serviceaccount.yaml
- inflated/prometheus/templates/alertmanager/service.yaml
- inflated/prometheus/templates/alertmanager/clusterrole.yaml
- inflated/prometheus/templates/alertmanager/cm.yaml
- inflated/prometheus/templates/alertmanager/deploy.yaml
- inflated/prometheus/templates/alertmanager/clusterrolebinding.yaml
- inflated/prometheus/templates/alertmanager/pvc.yaml
- inflated/prometheus/templates/server/serviceaccount.yaml
- inflated/prometheus/templates/server/service.yaml
- inflated/prometheus/templates/server/clusterrole.yaml
- inflated/prometheus/templates/server/cm.yaml
- inflated/prometheus/templates/server/deploy.yaml
- inflated/prometheus/templates/server/clusterrolebinding.yaml
- inflated/prometheus/templates/server/pvc.yaml

helmCharts:
- name: ingress-nginx
  version: "4.1.0"
  repo: https://kubernetes.github.io/ingress-nginx
  includeCRDs: true
  releaseName: ingress-nginx
  valuesInline:
    controller:
      publishService:
        enabled: true
      metrics:
        enabled: true
        service:
          annotations:
            prometheus.io/scrape: "true"
            prometheus.io/port: "10254"
- name: grafana
  repo: https://grafana.github.io/helm-charts
  version: "6.29.1"
  releaseName: grafana
  valuesInline:
    admin:
      existingSecret: grafana-credentials
    # Seems to launch a failing container, disabling for now:
    testFramework:
      enabled: false
    persistence:
      enabled: false
    # Note: datasources are patched in overlays to correct the URLs.
    # Including here is required for the helm chart to mount the configmap
    # volume.
    datasources:
      datasources.yaml:
        apiVersion: 1
        datasources:
        - isDefault: true
          name: Prometheus
          type: prometheus
          url: http://prometheus-server
    dashboardProviders:
      dashboardproviders.yaml:
        apiVersion: 1
        providers:
        - name: 'default'
          orgId: 1
          folder: ''
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/default
    dashboards:
      default:
        postgresql:
          gnetId: 9628
          revision: 7
          datasource: Prometheus
        node:
          gnetId: 1860
          revision: 26
          datasource: Prometheus
        nginx-ingress:
          gnetId: 9614
          revision: 1
          datasource: Prometheus
        kubernetes-apiserver:
          gnetId: 12006
          revision: 1
          datasource: Prometheus
